"""Tests for package_repo_scraper.py module.

This module contains unit tests and integration tests for the package_repo_scraper.py module.
The integration tests use the tests/testcache directory instead of the default .cache directory.
The test_cache.tar file is extracted into this directory to provide pre-populated cache data
for MySQL-related packages, ensuring consistent test results without network requests.
"""

from pathlib import Path
import pytest
import shutil
import tempfile
import tarfile
from unittest.mock import patch

from util import package_repo_scraper


@pytest.fixture
def test_cache_dir():
    """Use the tests/testcache directory for test cache.

    This fixture:
    1. Uses the tests/testcache directory instead of a temporary directory
    2. Extracts test_cache.tar into the tests/testcache directory if needed
    3. Patches package_repo_scraper.CACHE_DIR to use the tests/testcache directory
    4. Yields the tests/testcache directory for use in tests
    5. Cleans up the tests/testcache directory after tests are complete
    """
    base_dir = Path(__file__).parent
    test_cache_tar = base_dir / "test_cache.tar"
    test_cache_dir = base_dir / "test_cache"

    # Create the testcache directory if it doesn't exist
    test_cache_dir.mkdir(parents=True, exist_ok=True)

    # Patch the CACHE_DIR variable before extracting the test cache
    # This ensures that any cache operations during extraction use the test cache directory
    with patch.object(package_repo_scraper, 'CACHE_DIR', str(test_cache_dir)):
        # Extract test_cache.tar into the tests/testcache directory if needed
        if test_cache_tar.exists():
            with tarfile.open(test_cache_tar, "r") as tar:
                tar.extractall(path=base_dir, filter="data")
            print(f"Extracted test cache to {base_dir}")
        else:
            print(f"Warning: test_cache.tar not found at {test_cache_tar}")

        # Continue with the patched CACHE_DIR
        yield str(test_cache_dir)

        # Clean up the test cache directory after tests are complete
        if test_cache_dir.exists():
            shutil.rmtree(test_cache_dir)
            print(f"Cleaned up test cache directory: {test_cache_dir}")


class TestUnitFunctions:
    """Unit tests for individual functions in package_repo_scraper.py."""

    def test_generate_prefix_variants(self):
        """Test generate_prefix_variants function."""
        # Test with a simple name
        variants = package_repo_scraper.generate_prefix_variants("test")
        assert "test" in variants

        # Test with a name containing underscores
        variants = package_repo_scraper.generate_prefix_variants("test_name")
        assert "test_name" in variants
        assert "test.name" in variants
        assert "test+name" in variants
        assert "test@name" in variants

    def test_sanitize_package_name(self):
        """Test sanitize_package_name function."""
        assert package_repo_scraper.sanitize_package_name("test.name") == "test_name"
        assert package_repo_scraper.sanitize_package_name("test+name") == "test_name"
        assert package_repo_scraper.sanitize_package_name("test@name") == "test_name"
        assert package_repo_scraper.sanitize_package_name("test_name") == "test_name"

    def test_clean_filename(self):
        """Test clean_filename function."""
        assert package_repo_scraper.clean_filename("package-1.0-x86_64.pkg.tar.xz") == "package-1.0"
        assert package_repo_scraper.clean_filename("package-1.0-any.pkg.tar.zst") == "package-1.0"
        assert package_repo_scraper.clean_filename("package-1.0.pkg.tar.xz") == "package-1.0"

    def test_is_cache_expired(self):
        """Test is_cache_expired function."""
        # Test with non-existent file
        assert package_repo_scraper.is_cache_expired("non_existent_file")

        # Test with a file that was just created (should not be expired)
        with tempfile.NamedTemporaryFile() as temp_file:
            assert not package_repo_scraper.is_cache_expired(temp_file.name)

            # Test with a custom max_age_days
            assert not package_repo_scraper.is_cache_expired(temp_file.name, max_age_days=0.00001)
            # Wait a bit to ensure the file is now "expired"
            import time
            time.sleep(1)
            assert package_repo_scraper.is_cache_expired(temp_file.name, max_age_days=0.00001)


@pytest.mark.integration
class TestIntegration:
    """Integration tests for package_repo_scraper.py."""

    @pytest.mark.parametrize("package_name, expected_versions", [
        ("ejabberd-mod_mysql", {"20131114.1"}),
        ("ejabberd-mod_mysql-svn", {"1137.1"}),
        ("gambas3-gb-db-mysql", {
            "3.10.0.1", "3.10.0.3", "3.10.0.4", "3.10.0.5", "3.10.0.6", "3.11.3.1", "3.11.3.2", "3.11.3.3",
            "3.11.4.1", "3.11.4.2", "3.11.4.3", "3.11.4.4", "3.11.4.5", "3.11.4.6", "3.12.2.1", "3.12.2.2",
            "3.12.2.3", "3.13.0.2", "3.13.0.3", "3.13.0.4", "3.13.0.5", "3.13.0.6", "3.13.0.7", "3.14.0.1",
            "3.14.1.1", "3.14.1.2", "3.14.2.1", "3.14.2.2", "3.14.3.1", "3.14.3.10", "3.14.3.11", "3.14.3.12",
            "3.14.3.13", "3.14.3.14", "3.14.3.2", "3.14.3.3", "3.14.3.4", "3.14.3.5", "3.14.3.6", "3.14.3.7",
            "3.14.3.8", "3.14.3.9", "3.15.0.1", "3.15.0.2", "3.15.1.1", "3.15.2.1", "3.15.2.10", "3.15.2.11",
            "3.15.2.2", "3.15.2.3", "3.15.2.4", "3.15.2.5", "3.15.2.6", "3.15.2.7", "3.15.2.8", "3.15.2.9",
            "3.16.1.1", "3.16.2.1", "3.16.2.2", "3.16.2.3", "3.16.2.4", "3.16.2.5", "3.16.2.6", "3.16.3.1",
            "3.16.3.2", "3.16.3.3", "3.16.3.4", "3.16.3.5", "3.16.3.6", "3.16.3.7", "3.16.3.8", "3.17.0.1",
            "3.17.0.2", "3.17.1.1", "3.17.2.1", "3.17.2.2", "3.17.2.3", "3.17.2.4", "3.17.3.1", "3.17.3.2",
            "3.17.3.3", "3.17.3.4", "3.17.3.5", "3.17.3.6", "3.17.3.7", "3.17.3.8", "3.18.1.1", "3.18.2.1",
            "3.18.2.2", "3.18.2.3", "3.18.2.4", "3.18.3.1", "3.18.3.2", "3.18.4.1", "3.18.4.2", "3.18.4.3",
            "3.18.4.4", "3.19.0.1", "3.19.0.2", "3.19.1.1", "3.19.1.2", "3.19.2.1", "3.19.2.2", "3.19.3.1",
            "3.19.3.2", "3.19.3.3", "3.19.3.4", "3.19.5.1", "3.19.5.2", "3.19.5.3", "3.19.5.4", "3.19.5.5",
            "3.20.0.1", "3.20.0.2", "3.20.0.3", "3.20.1.1", "3.20.1.2", "3.20.2.1", "3.20.2.2", "3.20.2.3",
            "3.20.2.4", "3.20.3.1", "3.20.3.2", "3.20.4.1", "3.4.2.2", "3.5.0.2", "3.5.0.3", "3.5.1.1",
            "3.5.1.2", "3.5.1.3", "3.5.2.1", "3.5.3.1", "3.5.3.2", "3.5.4.1", "3.5.4.2", "3.5.4.3", "3.6.1.1",
            "3.6.2.1", "3.6.2.2", "3.6.2.3", "3.6.2.4", "3.6.2.5", "3.6.2.6", "3.7.1.1", "3.7.1.2", "3.7.1.3",
            "3.7.1.4", "3.8.1.1", "3.8.1.2", "3.8.1.3", "3.8.1.4", "3.8.4.1", "3.8.4.2", "3.8.4.3", "3.8.4.4",
            "3.8.4.5", "3.9.0.1", "3.9.1.1", "3.9.1.2", "3.9.1.3", "3.9.1.4", "3.9.2.1", "3.9.2.2", "3.9.2.3",
            "3.9.2.4", "3.9.2.5", "3.9.2.6", "3.9.2.7", "3.9.2.8", "3.9.2.9"
        }),
        # Add more test cases for other MySQL-related packages
    ])
    def test_mysql_packages(self, test_cache_dir, package_name, expected_versions):
        """Test that get_filename_versions returns the expected versions for MySQL-related packages."""
        # Mock the search results to avoid actual network requests
        # This is a simplified approach - in a real test, you might want to use more sophisticated mocking

        # For a real integration test that actually makes network requests, remove the mocking
        # and just call get_filename_versions directly

        # Get the version map for the package
        version_map = package_repo_scraper.get_filename_versions("mysql")

        # Check that the package is in the version map
        assert package_name in version_map, f"Package {package_name} not found in version map"

        # Check that the versions match the expected versions
        assert version_map[package_name] == expected_versions, \
            f"Versions for {package_name} don't match expected versions"

    def test_mysql_integration(self, test_cache_dir):
        """Integration test for MySQL-related packages.

        This test verifies that get_filename_versions returns the expected version maps
        for MySQL-related packages.
        """
        expected_version_maps = {
            "ejabberd-mod_mysql": {"20131114.1"},
            "ejabberd-mod_mysql-svn": {"1137.1"},
            "gambas3-gb-db-mysql": {
                "3.10.0.1", "3.10.0.3", "3.10.0.4", "3.10.0.5", "3.10.0.6", "3.11.3.1", "3.11.3.2", "3.11.3.3",
                "3.11.4.1", "3.11.4.2", "3.11.4.3", "3.11.4.4", "3.11.4.5", "3.11.4.6", "3.12.2.1", "3.12.2.2",
                "3.12.2.3", "3.13.0.2", "3.13.0.3", "3.13.0.4", "3.13.0.5", "3.13.0.6", "3.13.0.7", "3.14.0.1",
                "3.14.1.1", "3.14.1.2", "3.14.2.1", "3.14.2.2", "3.14.3.1", "3.14.3.10", "3.14.3.11", "3.14.3.12",
                "3.14.3.13", "3.14.3.14", "3.14.3.2", "3.14.3.3", "3.14.3.4", "3.14.3.5", "3.14.3.6", "3.14.3.7",
                "3.14.3.8", "3.14.3.9", "3.15.0.1", "3.15.0.2", "3.15.1.1", "3.15.2.1", "3.15.2.10", "3.15.2.11",
                "3.15.2.2", "3.15.2.3", "3.15.2.4", "3.15.2.5", "3.15.2.6", "3.15.2.7", "3.15.2.8", "3.15.2.9",
                "3.16.1.1", "3.16.2.1", "3.16.2.2", "3.16.2.3", "3.16.2.4", "3.16.2.5", "3.16.2.6", "3.16.3.1",
                "3.16.3.2", "3.16.3.3", "3.16.3.4", "3.16.3.5", "3.16.3.6", "3.16.3.7", "3.16.3.8", "3.17.0.1",
                "3.17.0.2", "3.17.1.1", "3.17.2.1", "3.17.2.2", "3.17.2.3", "3.17.2.4", "3.17.3.1", "3.17.3.2",
                "3.17.3.3", "3.17.3.4", "3.17.3.5", "3.17.3.6", "3.17.3.7", "3.17.3.8", "3.18.1.1", "3.18.2.1",
                "3.18.2.2", "3.18.2.3", "3.18.2.4", "3.18.3.1", "3.18.3.2", "3.18.4.1", "3.18.4.2", "3.18.4.3",
                "3.18.4.4", "3.19.0.1", "3.19.0.2", "3.19.1.1", "3.19.1.2", "3.19.2.1", "3.19.2.2", "3.19.3.1",
                "3.19.3.2", "3.19.3.3", "3.19.3.4", "3.19.5.1", "3.19.5.2", "3.19.5.3", "3.19.5.4", "3.19.5.5",
                "3.20.0.1", "3.20.0.2", "3.20.0.3", "3.20.1.1", "3.20.1.2", "3.20.2.1", "3.20.2.2", "3.20.2.3",
                "3.20.2.4", "3.20.3.1", "3.20.3.2", "3.20.4.1", "3.4.2.2", "3.5.0.2", "3.5.0.3", "3.5.1.1",
                "3.5.1.2", "3.5.1.3", "3.5.2.1", "3.5.3.1", "3.5.3.2", "3.5.4.1", "3.5.4.2", "3.5.4.3", "3.6.1.1",
                "3.6.2.1", "3.6.2.2", "3.6.2.3", "3.6.2.4", "3.6.2.5", "3.6.2.6", "3.7.1.1", "3.7.1.2", "3.7.1.3",
                "3.7.1.4", "3.8.1.1", "3.8.1.2", "3.8.1.3", "3.8.1.4", "3.8.4.1", "3.8.4.2", "3.8.4.3", "3.8.4.4",
                "3.8.4.5", "3.9.0.1", "3.9.1.1", "3.9.1.2", "3.9.1.3", "3.9.1.4", "3.9.2.1", "3.9.2.2", "3.9.2.3",
                "3.9.2.4", "3.9.2.5", "3.9.2.6", "3.9.2.7", "3.9.2.8", "3.9.2.9"
            },
            "gambas3-gb-mysql": {
                "3.10.0.1", "3.10.0.3", "3.10.0.4", "3.10.0.5", "3.10.0.6", "3.11.3.1", "3.11.3.2", "3.11.3.3",
                "3.11.4.1", "3.11.4.2", "3.11.4.3", "3.11.4.4", "3.11.4.5", "3.11.4.6", "3.12.2.1", "3.12.2.2",
                "3.12.2.3", "3.13.0.2", "3.13.0.3", "3.13.0.4", "3.13.0.5", "3.13.0.6", "3.13.0.7", "3.14.0.1",
                "3.14.1.1", "3.14.1.2", "3.14.2.1", "3.14.2.2", "3.14.3.1", "3.14.3.10", "3.14.3.11", "3.14.3.12",
                "3.14.3.13", "3.14.3.14", "3.14.3.2", "3.14.3.3", "3.14.3.4", "3.14.3.5", "3.14.3.6", "3.14.3.7",
                "3.14.3.8", "3.14.3.9", "3.15.0.1", "3.15.0.2", "3.15.1.1", "3.15.2.1", "3.15.2.10", "3.15.2.11",
                "3.15.2.2", "3.15.2.3", "3.15.2.4", "3.15.2.5", "3.15.2.6", "3.15.2.7", "3.15.2.8", "3.15.2.9",
                "3.16.1.1", "3.16.2.1", "3.16.2.2", "3.16.2.3", "3.16.2.4", "3.16.2.5", "3.16.2.6", "3.16.3.1",
                "3.16.3.2", "3.16.3.3", "3.16.3.4", "3.16.3.5", "3.16.3.6", "3.16.3.7", "3.16.3.8", "3.17.0.1",
                "3.17.0.2", "3.17.1.1", "3.17.2.1", "3.17.2.2", "3.17.2.3", "3.17.2.4", "3.17.3.1", "3.17.3.2",
                "3.17.3.3", "3.17.3.4", "3.17.3.5", "3.17.3.6", "3.17.3.7", "3.17.3.8", "3.18.1.1", "3.18.2.1",
                "3.18.2.2", "3.18.2.3", "3.18.2.4", "3.18.3.1", "3.18.3.2", "3.18.4.1", "3.18.4.2", "3.18.4.3",
                "3.18.4.4", "3.19.0.1", "3.19.0.2", "3.19.1.1", "3.19.1.2", "3.19.2.1", "3.19.2.2", "3.19.3.1",
                "3.19.3.2", "3.19.3.3", "3.19.3.4", "3.19.5.1", "3.19.5.2", "3.19.5.3", "3.19.5.4", "3.19.5.5",
                "3.20.0.1", "3.20.0.2", "3.20.0.3", "3.20.1.1", "3.20.1.2", "3.20.2.1", "3.20.2.2", "3.20.2.3",
                "3.20.2.4", "3.20.3.1", "3.20.3.2", "3.20.4.1", "3.4.2.2", "3.5.0.2", "3.5.0.3", "3.5.1.1",
                "3.5.1.2", "3.5.1.3", "3.5.2.1", "3.5.3.1", "3.5.3.2", "3.5.4.1", "3.5.4.2", "3.5.4.3", "3.6.1.1",
                "3.6.2.1", "3.6.2.2", "3.6.2.3", "3.6.2.4", "3.6.2.5", "3.6.2.6", "3.7.1.1", "3.7.1.2", "3.7.1.3",
                "3.7.1.4", "3.8.1.1", "3.8.1.2", "3.8.1.3", "3.8.1.4", "3.8.4.1", "3.8.4.2", "3.8.4.3", "3.8.4.4",
                "3.8.4.5", "3.9.0.1", "3.9.1.1", "3.9.1.2", "3.9.1.3", "3.9.1.4", "3.9.2.1", "3.9.2.2", "3.9.2.3",
                "3.9.2.4", "3.9.2.5", "3.9.2.6", "3.9.2.7", "3.9.2.8", "3.9.2.9"
            },
            "haskell-mysql": {
                "0.1.7.2.1", "0.1.7.2.10", "0.1.7.2.11", "0.1.7.2.12", "0.1.7.2.13", "0.1.7.2.14", "0.1.7.2.15",
                "0.1.7.2.16", "0.1.7.2.17", "0.1.7.2.18", "0.1.7.2.19", "0.1.7.2.2", "0.1.7.2.20", "0.1.7.2.21",
                "0.1.7.2.22", "0.1.7.2.23", "0.1.7.2.24", "0.1.7.2.25", "0.1.7.2.26", "0.1.7.2.27", "0.1.7.2.28",
                "0.1.7.2.29", "0.1.7.2.3", "0.1.7.2.4", "0.1.7.2.5", "0.1.7.2.6", "0.1.7.2.7", "0.1.7.2.8",
                "0.1.7.2.9", "0.1.7.3.1", "0.1.7.3.10", "0.1.7.3.11", "0.1.7.3.12", "0.1.7.3.13", "0.1.7.3.14",
                "0.1.7.3.2", "0.1.7.3.3", "0.1.7.3.4", "0.1.7.3.5", "0.1.7.3.6", "0.1.7.3.7", "0.1.7.3.8",
                "0.1.7.3.9", "0.2.0.1.1", "0.2.0.1.10", "0.2.0.1.11", "0.2.0.1.12", "0.2.0.1.13", "0.2.0.1.14",
                "0.2.0.1.15", "0.2.0.1.16", "0.2.0.1.17", "0.2.0.1.18", "0.2.0.1.19", "0.2.0.1.2", "0.2.0.1.20",
                "0.2.0.1.21", "0.2.0.1.22", "0.2.0.1.23", "0.2.0.1.24", "0.2.0.1.25", "0.2.0.1.26", "0.2.0.1.27",
                "0.2.0.1.28", "0.2.0.1.29", "0.2.0.1.3", "0.2.0.1.30", "0.2.0.1.31", "0.2.0.1.32", "0.2.0.1.33",
                "0.2.0.1.4", "0.2.0.1.5", "0.2.0.1.6", "0.2.0.1.7", "0.2.0.1.8", "0.2.0.1.9", "0.2.1", "0.2.1.1",
                "0.2.1.10", "0.2.1.100", "0.2.1.101", "0.2.1.102", "0.2.1.103", "0.2.1.104", "0.2.1.105",
                "0.2.1.106", "0.2.1.107", "0.2.1.108", "0.2.1.109", "0.2.1.11", "0.2.1.110", "0.2.1.111",
                "0.2.1.112", "0.2.1.113", "0.2.1.114", "0.2.1.115", "0.2.1.116", "0.2.1.12", "0.2.1.13",
                "0.2.1.14", "0.2.1.15", "0.2.1.16", "0.2.1.17", "0.2.1.18", "0.2.1.19", "0.2.1.2", "0.2.1.20",
                "0.2.1.21", "0.2.1.22", "0.2.1.23", "0.2.1.24", "0.2.1.25", "0.2.1.26", "0.2.1.27", "0.2.1.28",
                "0.2.1.29", "0.2.1.3", "0.2.1.30", "0.2.1.31", "0.2.1.32", "0.2.1.33", "0.2.1.34", "0.2.1.35",
                "0.2.1.36", "0.2.1.37", "0.2.1.38", "0.2.1.39", "0.2.1.4", "0.2.1.40", "0.2.1.41", "0.2.1.42",
                "0.2.1.43", "0.2.1.44", "0.2.1.45", "0.2.1.46", "0.2.1.47", "0.2.1.48", "0.2.1.49", "0.2.1.5",
                "0.2.1.50", "0.2.1.51", "0.2.1.52", "0.2.1.53", "0.2.1.54", "0.2.1.55", "0.2.1.56", "0.2.1.57",
                "0.2.1.58", "0.2.1.59", "0.2.1.6", "0.2.1.60", "0.2.1.61", "0.2.1.62", "0.2.1.63", "0.2.1.64",
                "0.2.1.65", "0.2.1.66", "0.2.1.67", "0.2.1.68", "0.2.1.69", "0.2.1.7", "0.2.1.70", "0.2.1.71",
                "0.2.1.72", "0.2.1.73", "0.2.1.74", "0.2.1.75", "0.2.1.76", "0.2.1.77", "0.2.1.78", "0.2.1.79",
                "0.2.1.8", "0.2.1.80", "0.2.1.81", "0.2.1.82", "0.2.1.83", "0.2.1.84", "0.2.1.85", "0.2.1.86",
                "0.2.1.87", "0.2.1.88", "0.2.1.89", "0.2.1.9", "0.2.1.90", "0.2.1.91", "0.2.1.92", "0.2.1.93",
                "0.2.1.94", "0.2.1.95", "0.2.1.96", "0.2.1.97", "0.2.1.98", "0.2.1.99", "0.2.10", "0.2.11",
                "0.2.2", "0.2.3", "0.2.4", "0.2.5", "0.2.6", "0.2.7", "0.2.8", "0.2.9"
            },
            "haskell-mysql-simple": {
                "0.4.5.1", "0.4.5.10", "0.4.5.11", "0.4.5.12", "0.4.5.13", "0.4.5.14", "0.4.5.15", "0.4.5.16",
                "0.4.5.17", "0.4.5.18", "0.4.5.19", "0.4.5.2", "0.4.5.20", "0.4.5.21", "0.4.5.22", "0.4.5.23",
                "0.4.5.24", "0.4.5.25", "0.4.5.26", "0.4.5.27", "0.4.5.28", "0.4.5.29", "0.4.5.3", "0.4.5.30",
                "0.4.5.31", "0.4.5.32", "0.4.5.33", "0.4.5.34", "0.4.5.35", "0.4.5.36", "0.4.5.37", "0.4.5.38",
                "0.4.5.39", "0.4.5.4", "0.4.5.40", "0.4.5.41", "0.4.5.42", "0.4.5.43", "0.4.5.44", "0.4.5.45",
                "0.4.5.46", "0.4.5.47", "0.4.5.48", "0.4.5.49", "0.4.5.5", "0.4.5.50", "0.4.5.51", "0.4.5.52",
                "0.4.5.53", "0.4.5.54", "0.4.5.55", "0.4.5.56", "0.4.5.57", "0.4.5.58", "0.4.5.59", "0.4.5.6",
                "0.4.5.60", "0.4.5.7", "0.4.5.8", "0.4.5.9", "0.4.6.1", "0.4.6.10", "0.4.6.11", "0.4.6.12",
                "0.4.6.13", "0.4.6.14", "0.4.6.15", "0.4.6.16", "0.4.6.17", "0.4.6.18", "0.4.6.19", "0.4.6.2",
                "0.4.6.20", "0.4.6.21", "0.4.6.22", "0.4.6.23", "0.4.6.24", "0.4.6.25", "0.4.6.26", "0.4.6.27",
                "0.4.6.28", "0.4.6.29", "0.4.6.3", "0.4.6.30", "0.4.6.31", "0.4.6.32", "0.4.6.33", "0.4.6.34",
                "0.4.6.35", "0.4.6.4", "0.4.6.5", "0.4.6.6", "0.4.6.7", "0.4.6.8", "0.4.6.9", "0.4.7.1",
                "0.4.7.1.1", "0.4.7.1.10", "0.4.7.1.11", "0.4.7.1.12", "0.4.7.1.13", "0.4.7.1.14", "0.4.7.1.15",
                "0.4.7.1.16", "0.4.7.1.17", "0.4.7.1.18", "0.4.7.1.19", "0.4.7.1.2", "0.4.7.1.20", "0.4.7.1.21",
                "0.4.7.1.3", "0.4.7.1.4", "0.4.7.1.5", "0.4.7.1.6", "0.4.7.1.7", "0.4.7.1.8", "0.4.7.1.9",
                "0.4.7.2", "0.4.7.2.1", "0.4.7.2.10", "0.4.7.2.11", "0.4.7.2.12", "0.4.7.2.13", "0.4.7.2.14",
                "0.4.7.2.15", "0.4.7.2.16", "0.4.7.2.17", "0.4.7.2.18", "0.4.7.2.19", "0.4.7.2.2", "0.4.7.2.20",
                "0.4.7.2.21", "0.4.7.2.22", "0.4.7.2.3", "0.4.7.2.4", "0.4.7.2.5", "0.4.7.2.6", "0.4.7.2.7",
                "0.4.7.2.8", "0.4.7.2.9", "0.4.7.3", "0.4.7.4", "0.4.7.5", "0.4.7.6", "0.4.7.7", "0.4.8.1",
                "0.4.8.1.1", "0.4.8.1.10", "0.4.8.1.11", "0.4.8.1.12", "0.4.8.1.2", "0.4.8.1.3", "0.4.8.1.4",
                "0.4.8.1.5", "0.4.8.1.6", "0.4.8.1.7", "0.4.8.1.8", "0.4.8.1.9", "0.4.8.2", "0.4.8.3", "0.4.9.1",
                "0.4.9.10", "0.4.9.11", "0.4.9.12", "0.4.9.13", "0.4.9.14", "0.4.9.15", "0.4.9.16", "0.4.9.17",
                "0.4.9.18", "0.4.9.19", "0.4.9.2", "0.4.9.20", "0.4.9.21", "0.4.9.22", "0.4.9.23", "0.4.9.24",
                "0.4.9.25", "0.4.9.26", "0.4.9.27", "0.4.9.28", "0.4.9.29", "0.4.9.3", "0.4.9.30", "0.4.9.31",
                "0.4.9.32", "0.4.9.33", "0.4.9.34", "0.4.9.35", "0.4.9.36", "0.4.9.37", "0.4.9.38", "0.4.9.39",
                "0.4.9.4", "0.4.9.40", "0.4.9.41", "0.4.9.42", "0.4.9.43", "0.4.9.44", "0.4.9.45", "0.4.9.46",
                "0.4.9.47", "0.4.9.48", "0.4.9.49", "0.4.9.5", "0.4.9.50", "0.4.9.51", "0.4.9.52", "0.4.9.53",
                "0.4.9.54", "0.4.9.55", "0.4.9.56", "0.4.9.57", "0.4.9.58", "0.4.9.59", "0.4.9.6", "0.4.9.60",
                "0.4.9.61", "0.4.9.62", "0.4.9.63", "0.4.9.64", "0.4.9.65", "0.4.9.66", "0.4.9.67", "0.4.9.68",
                "0.4.9.69", "0.4.9.7", "0.4.9.70", "0.4.9.8", "0.4.9.9"
            },
        }

        version_map = package_repo_scraper.get_filename_versions("mysql")

        # Check that all expected packages are in the version map
        for package_name, expected_versions in expected_version_maps.items():
            assert package_name in version_map, f"Package {package_name} not found in version map"
            assert version_map[package_name] == expected_versions, \
                f"Versions for {package_name} don't match expected versions"
